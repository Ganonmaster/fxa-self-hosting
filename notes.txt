# Get a LetsEncrypt certificate

# docker run -it --net=host --rm -v `pwd`/letsencrypt:/etc/letsencrypt fxa-letsencrypt /bin/bash
#
# $ service apache2 start
# -> check http://fxa.michielbdejong.com and https://fxa.michielbdejong.com (cert warning) show the apache default page
# $ ./letsencrypt-auto --apache --text -vv
# -> answer the questions: Yes, fxa.michielbdejong.com, michiel@mozilla.com, Agree
# $ exit
#
# cp -r `pwd`/letsencrypt/live/fxa.michielbdejong.com `pwd`/fxa-cert
# chmod -R ugo+r `pwd`/fxa-cert
# cat `pwd`/fxa-cert/cert.pem `pwd`/fxa-cert/chain.pem > `pwd`/fxa-cert/combined.pem

# Set up your pagekite frontend

# pagekite.py --isfrontend --domain *:fxa.michielbdejong.com:secretsecretsecret --ports=80,1111,3030,5000,8000,443,9010
# ## TODO: not use a http connection to the frontend

# Run setup.sh

Check the final output, maybe restart pagekite frontend and backend until https://fxa.michielbdejong.com
looks the same as https://192.186.99.100 (or whatever your Docker VM IP)

If DNS hasn't propagated yet, you may need something like:

docker exec -u root -it verifier.local /bin/bash
docker exec -u root -it profile /bin/bash
-> echo 45.32.232.152 fxa.michielbdejong.com >> /etc/hosts

# Creating your account

Sign up on https://fxa.michielbdejong.com:3030/, and instead of going to look
for the verification email, run:

 docker exec -it httpdb mysql -e "USE fxa; UPDATE accounts SET emailVerified=1;"

to mark your email address as verified.

NB: If you get https://fxa.michielbdejong.com:3030/unexpected_error, run
localStorage.clear() in the console and hard-refresh.
